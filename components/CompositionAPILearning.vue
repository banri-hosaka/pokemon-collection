<template>
  <div class="composition-api-learning">
    <h2>Vue.js Composition APIå­¦ç¿’</h2>

    <!-- ref ã®ä¾‹ -->
    <section class="example-section">
      <h3>1. refï¼ˆãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–å€¤ã«æœ€é©ï¼‰</h3>
      <div class="controls">
        <input v-model="userName" placeholder="åå‰ã‚’å…¥åŠ›">
        <button @click="userAge++">å¹´é½¢+1</button>
        <button @click="resetUser">ãƒªã‚»ãƒƒãƒˆ</button>
      </div>
      <div class="result">
        <p>åå‰: {{ userName }}</p>
        <p>å¹´é½¢: {{ userAge }}</p>
      </div>
      <div class="code-explanation">
        <strong>ãªãœrefã‚’ä½¿ã†ï¼Ÿ</strong><br>
        æ–‡å­—åˆ—ã‚„æ•°å€¤ãªã©ã®ãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–å€¤ã‚’æ‰±ã†ã¨ãã€‚
        <code>.value</code>ã§ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚
      </div>
    </section>

    <!-- reactive ã®ä¾‹ -->
    <section class="example-section">
      <h3>2. reactiveï¼ˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ ã«æœ€é©ï¼‰</h3>
      <div class="controls">
        <input v-model="pokemonData.name" placeholder="ãƒã‚±ãƒ¢ãƒ³å">
        <input v-model.number="pokemonData.level" placeholder="ãƒ¬ãƒ™ãƒ«">
        <button @click="addType">ã‚¿ã‚¤ãƒ—è¿½åŠ </button>
        <button @click="resetPokemon">ãƒªã‚»ãƒƒãƒˆ</button>
      </div>
      <div class="result">
        <p>åå‰: {{ pokemonData.name }}</p>
        <p>ãƒ¬ãƒ™ãƒ«: {{ pokemonData.level }}</p>
        <p>ã‚¿ã‚¤ãƒ—: {{ pokemonData.types.join(', ') }}</p>
      </div>
      <div class="code-explanation">
        <strong>ãªãœreactiveã‚’ä½¿ã†ï¼Ÿ</strong><br>
        ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚„é…åˆ—ãªã©ã€è¤‡æ•°ã®é–¢é€£ã™ã‚‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ã¾ã¨ã‚ã¦ç®¡ç†ã—ãŸã„ã¨ãã€‚
        <code>.value</code>ã¯ä¸è¦ã€‚
      </div>
    </section>

    <!-- computed ã®ä¾‹ -->
    <section class="example-section">
      <h3>3. computedï¼ˆè¨ˆç®—ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãƒ»ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚ã‚Šï¼‰</h3>
      <div class="controls">
        <input v-model.number="baseStats.hp" placeholder="HP">
        <input v-model.number="baseStats.attack" placeholder="æ”»æ’ƒ">
        <input v-model.number="baseStats.defense" placeholder="é˜²å¾¡">
      </div>
      <div class="result">
        <p>ç·åˆåŠ›: {{ totalStats }}</p>
        <p>è©•ä¾¡: {{ battleRating }}</p>
        <p>è¨ˆç®—å›æ•°: {{ computedCallCount }}å›</p>
      </div>
      <div class="code-explanation">
        <strong>ãªãœcomputedã‚’ä½¿ã†ï¼Ÿ</strong><br>
        ä»–ã®ãƒªã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªå€¤ã«ä¾å­˜ã™ã‚‹è¨ˆç®—çµæœã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ãŸã„ã¨ãã€‚
        ä¾å­˜ã™ã‚‹å€¤ãŒå¤‰ã‚ã‚‰ãªã„é™ã‚Šã€å†è¨ˆç®—ã•ã‚Œãªã„ï¼ˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Šï¼‰ã€‚
      </div>
    </section>

    <!-- ä½¿ã„åˆ†ã‘ã®åˆ¤æ–­åŸºæº– -->
    <section class="summary-section">
      <h3>ğŸ“ ä½¿ã„åˆ†ã‘ã®åˆ¤æ–­åŸºæº–</h3>
      <ul>
        <li><strong>ref</strong>: æ–‡å­—åˆ—ã€æ•°å€¤ã€çœŸå½å€¤ãªã©å˜ä¸€ã®å€¤</li>
        <li><strong>reactive</strong>: ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€é…åˆ—ãªã©è¤‡æ•°ã®å€¤ã‚’ã¾ã¨ã‚ã¦ç®¡ç†</li>
        <li><strong>computed</strong>: ä»–ã®å€¤ã‹ã‚‰è¨ˆç®—ã•ã‚Œã‚‹å€¤ï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒæ¬²ã—ã„ï¼‰</li>
      </ul>
    </section>
  </div>
</template>

<script setup>
import { ref, reactive, computed } from 'vue'

// ref ã®ä¾‹ï¼šãƒ—ãƒªãƒŸãƒ†ã‚£ãƒ–å€¤
const userName = ref('')
const userAge = ref(20)

function resetUser() {
  userName.value = ''
  userAge.value = 20
}

// reactive ã®ä¾‹ï¼šã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
const pokemonData = reactive({
  name: 'ãƒ”ã‚«ãƒãƒ¥ã‚¦',
  level: 1,
  types: ['ã§ã‚“ã']
})

function addType() {
  const types = ['ã»ã®ãŠ', 'ã¿ãš', 'ãã•', 'ã²ã“ã†', 'ã‚¨ã‚¹ãƒ‘ãƒ¼']
  const randomType = types[Math.floor(Math.random() * types.length)]
  if (!pokemonData.types.includes(randomType)) {
    pokemonData.types.push(randomType)
  }
}

function resetPokemon() {
  pokemonData.name = 'ãƒ”ã‚«ãƒãƒ¥ã‚¦'
  pokemonData.level = 1
  pokemonData.types = ['ã§ã‚“ã']
}

// computed ã®ä¾‹ï¼šè¨ˆç®—ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£
const baseStats = reactive({
  hp: 100,
  attack: 80,
  defense: 60
})

let totalStatsCallCount = 0
let battleRatingCallCount = 0

// computed ã¯ä¾å­˜ã™ã‚‹å€¤ãŒå¤‰ã‚ã£ãŸæ™‚ã®ã¿å†è¨ˆç®—ã•ã‚Œã‚‹
const totalStats = computed(() => {
  totalStatsCallCount++
  console.log('totalStats ãŒå†è¨ˆç®—ã•ã‚Œã¾ã—ãŸ:', totalStatsCallCount)
  return baseStats.hp + baseStats.attack + baseStats.defense
})

const battleRating = computed(() => {
  battleRatingCallCount++
  console.log('battleRating ãŒå†è¨ˆç®—ã•ã‚Œã¾ã—ãŸ:', battleRatingCallCount)
  if (totalStats.value >= 300) return 'Sç´š'
  if (totalStats.value >= 250) return 'Aç´š'
  if (totalStats.value >= 200) return 'Bç´š'
  return 'Cç´š'
})

// è¡¨ç¤ºç”¨ã®ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ï¼ˆãƒªã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã§ãªã„ï¼‰
const computedCallCount = computed(() => totalStatsCallCount + battleRatingCallCount)
</script>

<style scoped>
.composition-api-learning {
  padding: 20px;
  max-width: 900px;
  margin: 0 auto;
}

.example-section {
  margin: 30px 0;
  padding: 20px;
  border: 2px solid #e1e5e9;
  border-radius: 8px;
  background: #f8f9fa;
}

.controls {
  display: flex;
  gap: 10px;
  margin-bottom: 15px;
  flex-wrap: wrap;
}

.controls input {
  padding: 8px 12px;
  border: 1px solid #ccc;
  border-radius: 4px;
}

.controls button {
  padding: 8px 12px;
  background: #007bff;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
}

.controls button:hover {
  background: #0056b3;
}

.result {
  padding: 15px;
  background: white;
  border-radius: 4px;
  margin-bottom: 15px;
}

.result p {
  margin: 5px 0;
  font-weight: bold;
}

.code-explanation {
  padding: 10px;
  background: #e9ecef;
  border-radius: 4px;
  font-size: 14px;
}

.code-explanation code {
  background: #f8f9fa;
  padding: 2px 4px;
  border-radius: 3px;
  font-family: monospace;
}

.summary-section {
  margin: 30px 0;
  padding: 20px;
  background: #d1ecf1;
  border-radius: 8px;
}

.summary-section ul {
  list-style: none;
  padding: 0;
}

.summary-section li {
  margin: 10px 0;
  padding: 8px;
  background: white;
  border-radius: 4px;
}
</style>